(()=>{var Q=($=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy($,{get:(G,q)=>(typeof require<"u"?require:G)[q]}):$)(function($){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+$+'" is not supported')});var X=($,G)=>()=>(G||$((G={exports:{}}).exports,G),G.exports);var Y=X((ot,L)=>{(function(){function $(q,u){return u?Q(q):q.slice?$[O(q)]:function(k,x){q(k={exports:{}}),$[O(x)]=k.exports};function O(k){return k.split("/").slice(-1).toString().replace(".js","")}}if(typeof L<"u")var G=L;$(function(q){String.random=function(O,k){var x="";for(O=O||24,k=k||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";O-- >0;)x+=k.charAt(Math.floor(Math.random()*k.length));return x},String.match=function(O,k){var x,m;return typeof O!="string"?!1:(typeof k=="string"&&(k={"=":k}),k=k||{},x=k["="]||k["*"]||k[">"]||k["<"],O===x?!0:m!==k["="]?!1:(x=k["*"]||k[">"],O.slice(0,(x||"").length)===x?!0:m!==k["*"]?!1:m!==k[">"]&&m!==k["<"]?O>=k[">"]&&O<=k["<"]:m!==k[">"]&&O>=k[">"]||m!==k["<"]&&O<=k["<"]))},String.hash=function(O,k){if(typeof O=="string"){if(k=k||0,!O.length)return k;for(var x=0,m=O.length,D;x<m;++x)D=O.charCodeAt(x),k=(k<<5)-k+D,k|=0;return k}};var u=Object.prototype.hasOwnProperty;Object.plain=function(O){return O?O instanceof Object&&O.constructor===Object||Object.prototype.toString.call(O).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(O,k){for(var x in O)if(u.call(O,x)&&(!k||k.indexOf(x)==-1))return!1;return!0},Object.keys=Object.keys||function(O){var k=[];for(var x in O)u.call(O,x)&&k.push(x);return k},function(){var O,k=setTimeout,x=0,m=0,D=typeof setImmediate!=""+O&&setImmediate||function(i,s){return typeof MessageChannel==""+O?k:((i=new MessageChannel).port1.onmessage=function(j){j.data==""&&s()},function(j){s=j,i.port2.postMessage("")})}(),l=k.check=k.check||typeof performance!=""+O&&performance||{now:function(){return+new Date}};k.hold=k.hold||9,k.poll=k.poll||function(i){if(k.hold>=l.now()-x&&m++<3333){i();return}D(function(){x=l.now(),i()},m=0)}}(),function(){var O=setTimeout,k=O.turn=O.turn||function(s){x.push(s)==1&&m(i)},x=k.s=[],m=O.poll,D=0,l,i=function(){(l=x[D++])&&l(),(D==x.length||D==99)&&(x=k.s=x.slice(D),D=0),x.length&&m(i)}}(),function(){var O,k=setTimeout,x=k.turn;(k.each=k.each||function(m,D,l,i){i=i||9,function s(j,d,T){if(d=(j=(m||[]).splice(0,i)).length){for(var a=0;a<d&&O===(T=D(j[a]));a++);if(O===T){x(s);return}}l&&l(T)}()})()}()})($,"./shim"),$(function(q){q.exports=function u(l,k,x){if(!l)return{to:u};var m,D=typeof k=="function",l=(this.tag||(this.tag={}))[l]||D&&(this.tag[l]={tag:l,to:u._={next:function(s){var j;(j=this.to)&&j.next(s)}}});if(D){var i={off:u.off||(u.off=function(){if(this.next===u._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=u._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:u._,next:k,the:l,on:this,as:x};return(i.back=l.last||l).to=i,l.last=i}return(l=l.to)&&m!==k&&l.next(k),l}})($,"./onto"),$(function(q){q.exports=function(u){return u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"&&u!=1/0&&u!=-1/0&&u===u||!!u&&typeof u["#"]=="string"&&Object.keys(u).length===1&&u["#"]}})($,"./valid"),$(function(q){$("./shim");function u(){var l=+new Date;return m<l?(k=0,m=l+u.drift):m=l+(k+=1)/x+u.drift}u.drift=0;var O=-1/0,k=0,x=999,m=O,D;u.is=function(l,i,s){var j=i&&l&&l._&&l._[">"]||s;if(j)return typeof(j=j[i])=="number"?j:O},u.ify=function(l,i,s,j,d){(l=l||{})._=l._||{},d&&(l._["#"]=d);var T=l._[">"]||(l._[">"]={});return D!==i&&i!=="_"&&(typeof s=="number"&&(T[i]=s),D!==j&&(l[i]=j)),l},q.exports=u})($,"./state"),$(function(q){$("./shim");function u(O){var k={s:{}},x=k.s;O=O||{max:999,age:1e3*9},k.check=function(D){return x[D]?m(D):!1};var m=k.track=function(D){var l=x[D]||(x[D]={});return l.was=k.now=+new Date,k.to||(k.to=setTimeout(k.drop,O.age+9)),m.ed&&m.ed(D),l};return k.drop=function(D){k.to=null,k.now=+new Date;var l=Object.keys(x);console.STAT&&console.STAT(k.now,+new Date-k.now,"dup drop keys"),setTimeout.each(l,function(i){var s=x[i];s&&(D||O.age)>k.now-s.was||delete x[i]},0,99)},k}q.exports=u})($,"./dup"),$(function(q){$("./onto"),q.exports=function(k,x){if(this.on){var m=(this.opt||{}).lack||9e3;if(typeof k!="function"){if(!k)return;var l=k["#"]||k,D=(this.tag||"")[l];return D?(x&&(D=this.on(l,x),clearTimeout(D.err),D.err=setTimeout(function(){D.off()},m)),!0):void 0}var l=x&&x["#"]||u(9);if(!k)return l;var i=this.on(l,k,x);return i.err=i.err||setTimeout(function(){i.off(),i.next({err:"Error: No ACK yet.",lack:!0})},m),l}};var u=String.random||function(){return Math.random().toString(36).slice(2)}})($,"./ask"),$(function(q){function u(d){return d instanceof u?(this._={$:this}).$:this instanceof u?u.create(this._={$:this,opt:d}):new u(d)}u.is=function(d){return d instanceof u||d&&d._&&d===d._.$||!1},u.version=.202,u.chain=u.prototype,u.chain.toJSON=function(){},$("./shim"),u.valid=$("./valid"),u.state=$("./state"),u.on=$("./onto"),u.dup=$("./dup"),u.ask=$("./ask"),function(){u.create=function(t){t.root=t.root||t,t.graph=t.graph||{},t.on=t.on||u.on,t.ask=t.ask||u.ask,t.dup=t.dup||u.dup();var n=t.$.opt(t.opt);return t.once||(t.on("in",d,t),t.on("out",d,t),t.on("put",w,t),u.on("create",t),t.on("create",t)),t.once=1,n};function d(t){if(t){if(t.out===d){this.to.next(t);return}var n=this,e=n.as,c=e.at||e,S=c.$,b=c.dup,v,A=t.DBG;if((v=t["#"])||(v=t["#"]=k(9)),!b.check(v)){if(b.track(v),v=t._,t._=typeof v=="function"?v:function(){},t.$&&t.$===(t.$._||"").$||(t.$=S),t["@"]&&!t.put&&f(t),!c.ask(t["@"],t))if(A&&(A.u=+new Date),t.put){T(t);return}else t.get&&u.on.get(t,S);A&&(A.uc=+new Date),n.to.next(t),A&&(A.ua=+new Date),!(t.nts||t.NTS)&&(t.out=d,c.on("out",t),A&&(A.ue=+new Date))}}}function T(t){if(t){var n=t._||"",e=n.root=((n.$=t.$||"")._||"").root;if(t["@"]&&n.faith&&!n.miss){t.out=d,e.on("out",t);return}n.latch=e.hatch,n.match=e.hatch=[];var c=t.put,S=n.DBG=t.DBG,b=+new Date;if(M=M||b,!(c["#"]&&c["."])){S&&(S.p=b),n["#"]=t["#"],n.msg=t,n.all=0,n.stun=1;var v=Object.keys(c);console.STAT&&console.STAT(b,((S||n).pk=+new Date)-b,"put sort");var A=0,N,B,E,W,P,C,U;(function V(H){if(N!=A){if(N=A,!(E=v[A])){console.STAT&&console.STAT(b,((S||n).pd=+new Date)-b,"put"),r(n);return}(W=c[E])?(U=W._)?E!==U["#"]?C=h+g(E)+"soul not same.":(P=U[">"])||(C=h+g(E)+"no state."):C=h+g(E)+"no meta.":C=h+g(E)+"no node.",B=Object.keys(W||{})}if(C){t.err=n.err=C,r(n);return}var R=0,F;for(H=H||0;H++<9&&(F=B[R++]);)if(F!=="_"){var K=W[F],z=P[F];if(i===z){C=h+g(F)+"on"+g(E)+"no state.";break}if(!m(K)){C=h+g(F)+"on"+g(E)+"bad "+typeof K+g(K);break}a(K,F,E,z,t),++_}if((B=B.slice(R)).length){x(V);return}++A,B=null,V(H)})()}}}u.on.put=T;function a(t,n,e,c,S){var b=S._||"",v=b.root,A=v.graph,N,B,E=A[e]||s,W=D(E,n,1),P=E[n],C=b.DBG;(B=console.STAT)&&(!A[e]||!P)&&(B.has=(B.has||0)+1);var U=o(),V;if(c>U){setTimeout(function(){a(t,n,e,c,S)},(B=c-U)>I?I:B),console.STAT&&console.STAT((C||b).Hf=+new Date,B,"future");return}if(!(c<W)&&!(!b.faith&&c===W&&(t===P||y(t)<=y(P))&&!b.miss)){b.stun++;var H=S["#"]+b.all++,R={toString:function(){return H},_:b};R.toJSON=R.toString,v.dup.track(R)["#"]=S["#"],C&&(C.ph=C.ph||+new Date),v.on("put",{"#":R,"@":S["@"],put:{"#":e,".":n,":":t,">":c},ok:S.ok,_:b})}}function w(t){var n;(n=(t._||"").DBG)&&(n.pa=+new Date,n.pm=n.pm||+new Date);var e=this,c=e.as,S=c.graph,b=t._,v=t.put,A=v["#"],N=v["."],B=v[":"],E=v[">"],W=t["#"],P;(P=b.msg)&&(P=P.put)&&(P=P[A])&&l(P,N,E,B,A),S[A]=l(S[A],N,E,B,A),(P=(c.next||"")[A])&&P.on("in",t),r(b),e.to.next(t)}function r(t,n){var e;if(!t.stop&&!(!t.err&&0<--t.stun)&&(t.stop=1,!!(e=t.root))){var c=t.match;c.end=1,c===e.hatch&&(!(c=t.latch)||c.end?delete e.hatch:e.hatch=c),t.hatch&&t.hatch(),setTimeout.each(t.match,function(S){S&&S()}),!(!(n=t.msg)||t.err||n.err)&&(n.out=d,t.root.on("out",n),J())}}function f(t){var n=t["@"]||"",e,c,S;if(!(e=n._)){var b=(b=t.$)&&(b=b._)&&(b=b.root)&&(b=b.dup);if(!(b=b.check(n)))return;t["@"]=b["#"]||t["@"];return}e.acks=(e.acks||0)+1,(e.err=t.err)&&(t["@"]=e["#"],r(e)),e.ok=t.ok||e.ok,!e.stop&&!e.crack&&(e.crack=e.match&&e.match.push(function(){p(e)})),p(e)}function p(t){!t||!t.root||t.stun||t.acks!==t.all||t.root.on("in",{"@":t["#"],err:t.err,ok:t.err?i:t.ok||{"":1}})}var h="Error: Invalid graph!",g=function(t){return" '"+(""+t).slice(0,9)+"...' "},y=JSON.stringify,I=2147483647,o=u.state,_=0,M,J=function(){_>999&&_/-(M-(M=+new Date))>1&&(u.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),J=function(){_=0})}}(),function(){u.on.get=function(T,a){var w=a._,r=T.get,f=r["#"],p=w.graph[f],h=r["."],g=w.next||(w.next={}),y=g[f],I=T._||{},o=I.DBG=T.DBG;if(o&&(o.g=+new Date),!p)return w.on("get",T);if(h){if((typeof h!="string"||i===p[h])&&!((y||"").next||"")[h]){w.on("get",T);return}p=l({},h,D(p,h),p[h],f)}p&&d(T,p),w.on("get",T)};function d(T,a){var w=+new Date,r=T._||{},f=r.DBG=T.DBG,p=T["#"],h=k(9),g=Object.keys(a||"").sort(),y=((a||"")._||"")["#"],I=g.length,o=0,_=T.$._.root,M=a===_.graph[y];console.STAT&&console.STAT(w,((f||r).gk=+new Date)-w,"got keys"),a&&function J(){w=+new Date;for(var t=0,n,e={},c;t<9&&(n=g[t++]);)l(e,n,D(a,n),a[n],y);g=g.slice(t),(c={})[y]=e,e=c;var S;M&&(S=function(){},S.ram=S.faith=!0),c=g.length,console.STAT&&console.STAT(w,-(w-(w=+new Date)),"got copied some"),f&&(f.ga=+new Date),_.on("in",{"@":p,"#":h,put:e,"%":c?h=k(9):i,$:_.$,_:S,DBG:f,FOO:1}),console.STAT&&console.STAT(w,+new Date-w,"got in"),c&&setTimeout.turn(J)}(),a||_.on("in",{"@":T["#"]})}u.on.get.ack=d}(),function(){u.chain.opt=function(d){d=d||{};var T=this,a=T._,w=d.peers||d;return Object.plain(d)||(d={}),Object.plain(a.opt)||(a.opt=d),typeof w=="string"&&(w=[w]),Object.plain(a.opt.peers)||(a.opt.peers={}),w instanceof Array&&(d.peers={},w.forEach(function(r){var f={};f.id=f.url=r,d.peers[r]=a.opt.peers[r]=a.opt.peers[r]||f})),O(d,function r(f){var p=this[f];if(this&&this.hasOwnProperty(f)||typeof p=="string"||Object.empty(p)){this[f]=p;return}p&&p.constructor!==Object&&!(p instanceof Array)||O(p,r)}),a.opt.from=d,u.on("opt",a),a.opt.uuid=a.opt.uuid||function(f){return u.state().toString(36).replace(".","")+String.random(f||12)},T}}();var O=function(d,T){Object.keys(d).forEach(T,d)},k=String.random,x=setTimeout.turn,m=u.valid,D=u.state.is,l=u.state.ify,i,s={},j;u.log=function(){return!u.log.off&&j.log.apply(j,arguments),[].slice.call(arguments).join(" ")},u.log.once=function(d,T,a){return(a=u.log.once)[d]=a[d]||0,a[d]++||u.log(T)},typeof window<"u"&&((window.GUN=window.Gun=u).window=window);try{typeof G<"u"&&(G.exports=u)}catch{}q.exports=u,(u.window||{}).console=(u.window||{}).console||{log:function(){}},(j=console).only=function(d,T){return j.only.i&&d===j.only.i&&j.only.i++&&(j.log.apply(j,arguments)||T)},u.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})($,"./root"),$(function(q){var u=$("./root");u.chain.back=function(x,m){var D;if(x=x||1,x===-1||x===1/0)return this._.root.$;if(x===1)return(this._.back||this._).$;var l=this,i=l._;if(typeof x=="string"&&(x=x.split(".")),x instanceof Array){var s=0,j=x.length,D=i;for(s;s<j;s++)D=(D||O)[x[s]];return k!==D?m?l:D:(D=i.back)?D.$.back(x,m):void 0}if(typeof x=="function"){for(var d,D={back:i};(D=D.back)&&k===(d=x(D,m)););return d}return typeof x=="number"?(i.back||i).$.back(x-1):this};var O={},k})($,"./back"),$(function(q){var u=$("./root");u.chain.chain=function(r){var f=this,p=f._,h=new(r||f).constructor(f),g=h._,y;return g.root=y=p.root,g.id=++y.once,g.back=f._,g.on=u.on,g.on("in",u.on.in,g),g.on("out",u.on.out,g),h};function O(r){var f,p,h=this.as,g=h.back,y=h.root,I;if(r.$||(r.$=h.$),this.to.next(r),h.err){h.on("in",{put:h.put=i,$:h.$});return}if(p=r.get){if(y.pass&&(y.pass[h.id]=h),h.lex&&Object.keys(h.lex).forEach(function(o){I[o]=h.lex[o]},I=r.get=r.get||{}),p["#"]||h.soul){if(p["#"]=p["#"]||h.soul,r["#"]||(r["#"]=s(9)),g=y.$.get(p["#"])._,p=p["."]){if(d(g.put,p)&&(I=g.ask&&g.ask[p],(g.ask||(g.ask={}))[p]=g.$.get(p)._,g.on("in",{get:p,put:{"#":g.soul,".":p,":":g.put[p],">":a(y.graph[g.soul],p)}}),I))return}else{if(I=g.ask&&g.ask[""],(g.ask||(g.ask={}))[""]=g,i!==g.put&&(g.on("in",g),I))return;r.$=g.$}return y.ask(D,r),y.on("in",r)}if(p["."])return h.get?(r={get:{".":h.get},$:h.$},(g.ask||(g.ask={}))[h.get]=r.$._,g.on("out",r)):(r={get:h.lex?r.get:{},$:h.$},g.on("out",r));if((h.ask||(h.ask={}))[""]=h,h.get)return p["."]=h.get,(g.ask||(g.ask={}))[h.get]=r.$._,g.on("out",r)}return g.on("out",r)}u.on.out=O;function k(r,f){f=f||this.as;var p=f.root,h=r.$||(r.$=f.$),g=(h||"")._||l,y=r.put||"",I=y["#"],o=y["."],_=i!==y["="]?y["="]:y[":"],M=y[">"]||-1/0,J;if(i!==r.put&&(i===y["#"]||i===y["."]||i===y[":"]&&i===y["="]||i===y[">"])){if(!j(y)){if(!(I=((y||"")._||"")["#"])){console.log("chain not yet supported for",y,"...",r,f);return}return h=f.root.$.get(I),setTimeout.each(Object.keys(y).sort(),function(t){t=="_"||i===(M=a(y,t))||f.on("in",{$:h,put:{"#":I,".":t,"=":y[t],">":M},VIA:r})})}f.on("in",{$:g.back.$,put:{"#":I=g.back.soul,".":o=g.has||g.get,"=":y,">":a(g.back.put,o)},via:r});return}(r.seen||"")[f.id]||((r.seen||(r.seen=function(){}))[f.id]=f,f!==g&&(Object.keys(r).forEach(function(t){y[t]=r[t]},y={}),y.get=f.get||y.get,!f.soul&&!f.has?y.$$$=y.$$$||f.$:g.soul&&(y.$=f.$,y.$$=y.$$||g.$),r=y),m(r,f),(f.soul||r.$$)&&M>=a(p.graph[I],o)&&((y=p.$.get(I)._).put=w(y.put,o,M,_,I)),!g.soul&&M>=a(p.graph[I],o)&&(J=(p.$.get(I)._.next||"")[o])&&(J.put=_,typeof(y=j(_))=="string"&&(J.put=p.$.get(y)._.put||_)),this.to&&this.to.next(r),f.any&&setTimeout.each(Object.keys(f.any),function(t){(t=f.any[t])&&t(r)},0,99),f.echo&&setTimeout.each(Object.keys(f.echo),function(t){(t=f.echo[t])&&t.on("in",r)},0,99),((r.$$||"")._||g).soul&&(J=f.next)&&(J=J[o])&&(y={},Object.keys(r).forEach(function(t){y[t]=r[t]}),y.$=(r.$$||r.$).get(y.get=o),delete y.$$,delete y.$$$,J.on("in",y)),x(r,f))}u.on.in=k;function x(r,f){if(f=f||this.as||r.$._,!(r.$$&&this!==u.on)&&!(!r.put||f.soul)){var p=r.put||"",h=p["="]||p[":"],o,g=f.root,y=g.$.get(p["#"]).get(p["."])._;if(typeof(h=j(h))!="string"){this===u.on&&((y.echo||(y.echo={}))[f.id]=f);return}if(!((y.echo||(y.echo={}))[f.id]&&!(g.pass||"")[f.id])){if(o=g.pass){if(o[h+f.id])return;o[h+f.id]=1}(y.echo||(y.echo={}))[f.id]=f,f.has&&(f.link=h);var I=g.$.get(y.link=h)._;(I.echo||(I.echo={}))[y.id]=y;var o=f.ask||"";(o[""]||f.lex)&&I.on("out",{get:{"#":h}}),setTimeout.each(Object.keys(o),function(_,M){!_||!(M=o[_])||M.on("out",{get:{"#":h,".":_}})},0,99)}}}u.on.link=x;function m(r,f){var p=r.put||"",h=i!==p["="]?p["="]:p[":"],g=f.root,y,I;if(i===h){if(f.soul&&i!==f.put||(I=(r.$$||r.$||"")._||"",r["@"]&&(i!==I.put||i!==f.put)))return;(y=f.link||r.linked)&&delete(g.$.get(y)._.echo||"")[f.id],f.has&&(f.link=null),f.put=i,setTimeout.each(Object.keys(f.next||""),function(o,_){(_=f.next[o])&&(y&&delete(g.$.get(y).get(o)._.echo||"")[_.id],_.on("in",{get:o,put:i,$:_.$}))},0,99);return}f.soul||r.$$||(y=j(h),I=r.$._||"",!((y===I.link||f.has&&!I.link)&&!((g.pass||"")[f.id]&&typeof y!="string"))&&(delete(I.echo||"")[f.id],m({get:f.get,put:i,$:r.$,linked:r.linked=r.linked||I.link},f)))}u.on.unlink=m;function D(r,f){var p=this.as,h=p.$._,g=h.root,y=p.get||"",I=(r.put||"")[y["#"]]||"";if(!r.put||typeof y["."]=="string"&&i===I[y["."]]){if(i!==h.put||!h.soul&&!h.has)return;h.ack=(h.ack||0)+1,h.on("in",{get:h.get,put:h.put=i,$:h.$,"@":r["@"]});return}(r._||{}).miss=1,u.on.put(r)}var l={},i,s=String.random,j=u.valid,d=function(r,f){return r&&Object.prototype.hasOwnProperty.call(r,f)},T=u.state,a=T.is,w=T.ify})($,"./chain"),$(function(q){var u=$("./root");u.chain.get=function(i,s,j){var d,T;if(typeof i=="string"){if(i.length==0)return(d=this.chain())._.err={err:u.log("0 length key!",i)},s&&s.call(d,d._.err),d;var a=this,w=a._,r=w.next||m;(d=r[i])||(d=i&&O(i,a)),d=d&&d.$}else if(typeof i=="function"){let o=function(_,M,J){if(!o.stun&&!((v=p.pass)&&!v[h])){var t=_.$._,n=(_.$$||"")._,e=(n||t).put,c=!t.has&&!t.soul,S={},b,v;if((c||l===e)&&(e=l===((v=_.put)||"")["="]?l===(v||"")[":"]?v:v[":"]:v["="]),(b=typeof(v=u.valid(e))=="string")&&(e=l===(v=p.$.get(v)._.put)?f.not?l:e:v),!(f.not&&l===e)){if(l===f.stun){if((v=p.stun)&&v.on&&(w.$.back(function(A){if(v.on(""+A.id,S={}),(S.run||0)<o.id)return S}),!S.run&&v.on(""+t.id,S={}),!S.run&&n&&v.on(""+n.id,S={}),o.id>S.run&&((!S.stun||S.stun.end)&&(S.stun=v.on("stun"),S.stun=S.stun&&S.stun.last),S.stun&&!S.stun.end))){(S.stun.add||(S.stun.add={}))[h]=function(){o(_,M,1)};return}if(l===e&&(J=0),(v=p.hatch)&&!v.end&&l===f.hatch&&!J){if(g[t.$._.id])return;g[t.$._.id]=1,v.push(function(){o(_,M,1)});return}g={}}if(p.pass){if(p.pass[h+t.id])return;p.pass[h+t.id]=1}if(f.on){f.ok.call(t.$,e,t.get,_,M||o);return}if(f.v2020){f.ok(_,M||o);return}Object.keys(_).forEach(function(A){v[A]=_[A]},v={}),_=v,_.put=e,f.ok.call(f.as,_,M||o)}}};var y=o;if(s===!0)return k(this,i,s,j),this;d=this;var w=d._,f=s||{},p=w.root,h;f.at=w,f.ok=i;var g={};return o.at=w,(w.any||(w.any={}))[h=String.random(7)]=o,o.off=function(){o.stun=1,w.any&&delete w.any[h]},o.rid=x,o.id=f.run||++p.once,T=p.pass,(p.pass={})[h]=1,f.out=f.out||{get:{}},w.on("out",f.out),p.pass=T,d}else{if(typeof i=="number")return this.get(""+i,s,j);if(typeof(T=D(i))=="string")return this.get(T,s,j);(T=this.get.next)&&(d=T(this,i))}return d?(s&&typeof s=="function"&&d.get(s,j),d):((d=this.chain())._.err={err:u.log("Invalid get request!",i)},s&&s.call(d,d._.err),d)};function O(i,s){var j=s._,d=j.next,T=s.chain(),a=T._;return d||(d=j.next={}),d[a.get=i]=a,s===j.root.$?a.soul=i:(j.soul||j.has)&&(a.has=i),a}function k(i,s,j,d){var T=i._,a=0,w;return(w=T.soul||T.link)?s(w,d,T):T.jam?T.jam.push([s,d]):(T.jam=[[s,d]],i.get(function(f,p){if(!(l===f.put&&!T.root.opt.super&&(w=Object.keys(T.root.opt.peers).length)&&++a<=w)){p.rid(f);var h=(h=f.$)&&h._||{},g=0,y;for(w=T.jam,delete T.jam;y=w[g++];){var I=y[0],o;y=y[1],I&&I(o=h.link||h.soul||u.valid(f.put)||((f.put||{})._||{})["#"],y,f,p)}}},{out:{get:{".":!0}}}),i)}function x(i){var s=this.at||this.on;if(!i||s.soul||s.has)return this.off();if(i=(i=(i=i.$||i)._||i).id){var j=s.map,d,T;if(d=(T=this.seen||(this.seen={}))[i])return!0;T[i]=!0}}var m={},D=u.valid,l})($,"./get"),$(function(q){var u=$("./root");u.chain.put=function(a,w,r){var f=this,p=f._,h=p.root;r=r||{},r.root=p.root,r.run||(r.run=h.once),O(r,p.id),r.ack=r.ack||w,r.via=r.via||f,r.data=r.data||a,r.soul||(r.soul=p.soul||typeof w=="string"&&w);var g=r.state=r.state||u.state();return typeof a=="function"?(a(function(y){r.data=y,f.put(D,D,r)}),f):r.soul?(r.$=h.$.get(r.soul),r.todo=[{it:r.data,ref:r.$}],r.turn=r.turn||s,r.ran=r.ran||k,function y(){var I=r.todo,o=I.pop(),_=o.it,M=o.ref&&o.ref._.id,J,t,n,e,c;if(O(r,o.ref),(e=o.todo)&&(t=e.pop(),_=_[t],e.length&&I.push(o)),t&&(I.path||(I.path=[])).push(t),!(J=j(_))&&!(c=u.is(_))){if(!Object.plain(_)){k.err(r,"Invalid data: "+m(_)+" at "+(r.via.back(function(N){N.get&&e.push(N.get)},e=[])||e.join("."))+"."+(I.path||[]).join("."));return}for(var S=r.seen||(r.seen=[]),b=S.length;b--;)if(_===(e=S[b]).it){J=_=e.link;break}}if(t&&J)o.node=d(o.node,t,g,_);else{let N=function(B,E){var W=n.link["#"];E&&(E.off(),E.rid(B));var P=W||B.soul||(e=(B.$$||B.$)._||"").soul||e.link||((e=e.put||"")._||"")["#"]||e["#"]||((e=B.put||"")&&B.$$?e["#"]:(e["="]||e[":"]||"")["#"]);if(!W&&O(r,B.$),!P&&!o.link["#"]){(o.wait||(o.wait=[])).push(function(){N(B,E)});return}P||(P=[],(B.$$||B.$).back(function(C){if(e=C.soul||C.link)return P.push(e);P.push(C.get)}),P=P.reverse().join("/")),n.link["#"]=P,!c&&(((r.graph||(r.graph={}))[P]=n.node||(n.node={_:{}}))._["#"]=P),delete r.wait[v],n.wait&&setTimeout.each(n.wait,function(C){C&&C()}),r.ran(r)};var A=N;if(!r.seen){k.err(r,"Data at root of graph must be a node (an object).");return}r.seen.push(n={it:_,link:{},todo:c?[]:Object.keys(_).sort().reverse(),path:(I.path||[]).slice(),up:o}),o.node=d(o.node,t,g,n.link),!c&&n.todo.length&&I.push(n);var v=r.seen.length;(r.wait||(r.wait={}))[v]="",e=(n.ref=c?_:t?o.ref.get(t):o.ref)._,(e=_&&(_._||"")["#"]||e.soul||e.link)?N({soul:e}):n.ref.get(N,{run:r.run,v2020:1,out:{get:{".":" "}}})}if(!I.length)return r.ran(r);r.turn(y)}(),f):(x(r),f)};function O(a,w){if(w){w=(w._||"").id||w;var r=a.root.stun||(a.root.stun={on:u.on}),f={},p;a.stun||(a.stun=r.on("stun",function(){})),(p=r.on(""+w))&&p.the.last.next(f),!(f.run>=a.run)&&r.on(""+w,function(h){if(a.stun.end){this.off(),this.to.next(h);return}h.run=h.run||a.run,h.stun=h.stun||a.stun})}}function k(a){if(a.err){k.end(a.stun,a.root);return}if(!(a.todo.length||a.end||!Object.empty(a.wait))){a.end=1;var w=a.$.back(-1)._,r=w.root,f=w.ask(function(y){r.on("ack",y),y.err&&!y.lack&&u.log(y),++p>(a.acks||0)&&this.off(),a.ack&&a.ack(y,this)},a.opt),p=0,h=a.stun,g;(g=function(){h&&(k.end(h,r),setTimeout.each(Object.keys(h=h.add||""),function(y){(y=h[y])&&y()}))}).hatch=g,a.ack&&!a.ok&&(a.ok=a.acks||9),a.via._.on("out",{put:a.out=a.graph,ok:a.ok&&{"@":a.ok+1},opt:a.opt,"#":f,_:g})}}k.end=function(a,w){a.end=i,a.the.to===a&&a===a.the.last&&delete w.stun,a.off()},k.err=function(a,w){(a.ack||i).call(a,a.out={err:a.err=u.log(w)}),a.ran(a)};function x(a){var w=a.via._,r;a.via=a.via.back(function(f){if(f.soul||!f.get)return f.$;r=a.data,(a.data={})[f.get]=r}),(!a.via||!a.via._.soul)&&(a.via=w.root.$.get(((a.data||"")._||"")["#"]||w.$.back("opt.uuid")())),a.via.put(a.data,a.ack,a)}function m(a,w){return a&&(w=a.constructor)&&w.name||typeof a}var D,l={},i=function(){},s=setTimeout.turn,j=u.valid,d=u.state.ify,T=function(a,w){a.call(w||l)}})($,"./put"),$(function(q){var u=$("./root");$("./chain"),$("./back"),$("./put"),$("./get"),q.exports=u})($,"./index"),$(function(q){var u=$("./index");u.chain.on=function(D,l,i,s){var j=this,d=j._,T=d.root,a,w,r,f;if(typeof D=="string")return l?(a=d.on(D,l,i||d,s),i&&i.$&&(i.subs||(i.subs=[])).push(a),j):d.on(D);var p=l;(p=p===!0?{change:!0}:p||{}).not=1,p.on=1;var h={};return j.get(D,p),j},u.chain.once=function(D,l){if(l=l||{},!D)return O(this,l);var i=this,s=i._,j=s.root,d=s.put,T=String.random(7),a,w;return i.get(function(r,f,p,h){var g=this,y=g._,I=y.one||(y.one={});if(h.stun||I[T]==="")return;if((w=u.valid(r))===!0){o();return}if(typeof w=="string")return;clearTimeout((s.one||"")[T]),clearTimeout(I[T]),I[T]=setTimeout(o,l.wait||99);function o(_){if(!y.has&&!y.soul&&(y={put:r,get:f}),m===(w=y.put)&&(w=((p.$$||"")._||"").put),typeof u.valid(w)=="string"&&(w=j.$.get(w)._.put,w===m&&!_)){I[T]=setTimeout(function(){o(1)},l.wait||99);return}h.stun||I[T]!==""&&(I[T]="",(s.soul||s.has)&&h.off(),D.call(g,w,y.get),clearTimeout(I[T]))}},{on:1}),i};function O(D,l,i){return u.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(i=D.chain())._.nix=D.once(function(s,j){i._.on("in",this._)}),i._.lex=D._.lex,i}u.chain.off=function(){var D=this,l=D._,i,s=l.back;if(s)return l.ack=0,(i=s.next)&&i[l.get]&&delete i[l.get],(i=s.any)&&(delete s.any,s.any={}),(i=s.ask)&&delete i[l.get],(i=s.put)&&delete i[l.get],(i=l.soul)&&delete s.root.graph[i],(i=l.map)&&Object.keys(i).forEach(function(j,d){d=i[j],d.link&&s.root.$.get(d.link).off()}),(i=l.next)&&Object.keys(i).forEach(function(j,d){d=i[j],d.$.off()}),l.on("off",{}),D};var k={},x=function(){},m})($,"./on"),$(function(q){var u=$("./index"),O=u.chain.get.next;u.chain.get.next=function(l,i){var s;return Object.plain(i)?(s=((s=i["#"])||"")["="]||s)?l.get(s):((s=l.chain()._).lex=i,l.on("in",function(j){String.match(j.get||(j.put||"")["."],i["."]||i["#"]||i)&&s.on("in",j),this.to.next(j)}),s.$):(O||x)(l,i)},u.chain.map=function(l,i,s){var j=this,d=j._,T,a;return Object.plain(l)&&(T=l["."]?l:{".":l},l=D),l?(u.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),a=j.chain(),j.map().on(function(w,r,f,p){var h=(l||x).call(this,w,r,f,p);if(D!==h){if(w===h)return a._.on("in",f);if(u.is(h))return a._.on("in",h._);var g={};Object.keys(f.put).forEach(function(y){g[y]=f.put[y]},g),g["="]=h,a._.on("in",{get:r,put:g})}}),a):((a=d.each)||((d.each=a=j.chain())._.lex=T||a._.lex||d.lex,a._.nix=j.back("nix"),j.on("in",k,a._)),a)};function k(l){this.to.next(l);var i=this.as,s=l.$,j=s._,d=l.put,T;!j.soul&&!l.$$||(T=i.lex)&&!String.match(l.get||(d||"")["."],T["."]||T["#"]||T)||u.on.link(l,i)}var x=function(){},m={stun:x,off:x},D})($,"./map"),$(function(q){var u=$("./index");u.chain.set=function(O,k,x){var m=this,D=m.back(-1),l,i;return k=k||function(){},x=x||{},x.item=x.item||O,(l=((O||"")._||"")["#"])&&((O={})["#"]=l),typeof(i=u.valid(O))=="string"?m.get(l=i).put(O,k,x):u.is(O)?(m.put(function(s){O.get(function(j,d,T){if(!j)return k.call(m,{err:u.log('Only a node can be linked! Not "'+T.put+'"!')});(i={})[j]={"#":j},s(i)},!0)}),O):(Object.plain(O)&&(O=D.get(l=m.back("opt.uuid")()).put(O)),m.get(l||D.back("opt.uuid")(7)).put(O,k,x))}})($,"./set"),$(function(q){$("./shim");var u=function(){},O=JSON.parseAsync||function(i,s,j){var d,T=+new Date;try{s(d,JSON.parse(i,j),k.sucks(+new Date-T))}catch(a){s(a)}},k=JSON.stringifyAsync||function(i,s,j,d){var T,a=+new Date;try{s(T,JSON.stringify(i,j,d),k.sucks(+new Date-a))}catch(w){s(w)}};k.sucks=function(i){i>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),k.sucks=u)};function x(i){var s=function(){},j=i.opt||{};j.log=j.log||console.log,j.gap=j.gap||j.wait||0,j.max=j.max||(j.memory?j.memory*999*999:3e8)*.3,j.pack=j.pack||j.max*.01*.01,j.puff=j.puff||9;var d=setTimeout.turn||setTimeout,T=i.dup,a=T.check,w=T.track,r=+new Date,f=r,p=s.hear=function(o,_){if(o){if(j.max<=o.length)return s.say({dam:"!",err:"Message too big!"},_);s===this&&(p.d+=o.length||0,++p.c);var M=_.SH=+new Date,J=o[0],t;if(J==="["){O(o,function(n,e){if(n||!e)return s.say({dam:"!",err:"DAM JSON parse error."},_);console.STAT&&console.STAT(+new Date,e.length,"# on hear batch");var c=j.puff;(function S(){for(var b=+new Date,v=0,A;v<c&&(A=e[v++]);)s.hear(A,_);e=e.slice(v),console.STAT&&console.STAT(b,+new Date-b,"hear loop"),g(_),e.length&&d(S,0)})()}),o="";return}if(J==="{"||(o["#"]||Object.plain(o))&&(t=o)){if(t)return p.one(t,_,M);O(o,function(n,e){if(n||!e)return s.say({dam:"!",err:"DAM JSON parse error."},_);p.one(e,_,M)});return}}};p.one=function(o,_,S){var J,t,n,e,c;if(o.DBG&&(o.DBG=c={DBG:o.DBG}),c&&(c.h=S),c&&(c.hp=+new Date),(J=o["#"])||(J=o["#"]=String.random(9)),!(n=a(J))&&(t=o["##"],!(t&&(n=o["@"]||o.get&&J)&&T.check(e=n+t)))){if((o._=function(){}).via=s.leap=_,(n=o["><"])&&typeof n=="string"&&n.slice(0,99).split(",").forEach(function(b){this[b]=1},o._.yo={}),n=o.dam){(n=s.hear[n])&&n(o,_,i),w(J);return}(n=o.ok)&&(o._.near=n["/"]);var S=+new Date;c&&(c.is=S),_.SI=J,w.ed=function(b){J===b&&(w.ed=0,(b=T.s[J])&&(b.via=_,o.get&&(b.it=o)))},i.on("in",s.last=o),c&&(c.hd=+new Date),console.STAT&&console.STAT(S,+new Date-S,o.get?"msg get":o.put?"msg put":"msg"),w(J),e&&w(e),s.leap=s.last=null}};var h=function(o,_,M){M(o,!0)};p.c=p.d=0,function(){var o=0,_;s.hash=function(n,e){var c,S,b,v=+new Date;k(n.put,function A(N,B){var E=(S||(S=b=B||"")).slice(0,32768);if(c=String.hash(E,c),S=S.slice(32768),S){d(A,0);return}console.STAT&&console.STAT(v,+new Date-v,"say json+hash"),n._.$put=b,n["##"]=c,s.say(n,e),delete n._.$put},M)};function M(n,e){var c;return e instanceof Object?(Object.keys(e).sort().forEach(J,{to:c={},on:e}),c):e}function J(n){this.to[n]=this.on[n]}var t=s.say=function(n,e){var c;if((c=this)&&(c=c.to)&&c.next&&c.next(n),!n)return!1;var S,b,v,A=n["@"],N=n._||(n._=function(){}),B=n.DBG,E=+new Date;if(N.y=N.y||E,e||B&&(B.y=E),(S=n["#"])||(S=n["#"]=String.random(9)),!_&&w(S),!(b=n["##"])&&l!==n.put&&!N.via&&A){s.hash(n,e);return}if(!e&&A&&(e=(c=T.s[A])&&(c.via||(c=c.it)&&(c=c._)&&c.via)||(c=s.last)&&A===c["#"]&&s.leap),!e&&A)return T.s[A]?void 0:(console.STAT&&console.STAT(+new Date,++o,"total no peer to ack to"),!1);if(A&&!n.put&&!b&&((T.s[A]||"").it||"")["##"])return!1;if(!e&&s.way)return s.way(n);if(B&&(B.yh=+new Date),!(v=N.raw)){s.raw(n,e);return}if(B&&(B.yr=+new Date),!e||!e.id){if(!Object.plain(e||j.peers))return!1;var E=+new Date,W=j.puff,P=j.peers,C=Object.keys(e||j.peers||{});console.STAT&&console.STAT(E,+new Date-E,"peer keys"),function H(){var R=+new Date;_=1;var F=N.raw;N.raw=v;for(var K=0,z;K<9&&(z=(C||"")[K++]);)(z=P[z]||(e||"")[z])&&s.say(n,z);N.raw=F,_=0,C=C.slice(K),console.STAT&&console.STAT(R,+new Date-R,"say loop"),C.length&&(d(H,0),A&&w(A))}();return}if(!e.wire&&s.wire&&s.wire(e),S!==e.last){if(e.last=S,e===N.via||(c=N.yo)&&(c[e.url]||c[e.pid]||c[e.id]))return!1;if(console.STAT&&console.STAT(E,((B||N).yp=+new Date)-(N.y||E),"say prep"),!_&&A&&w(A),e.batch){if(e.tail=(c=e.tail||0)+v.length,e.tail<=j.pack){e.batch+=(c?",":"")+v;return}g(e)}e.batch="[";var U=+new Date;setTimeout(function(){console.STAT&&console.STAT(U,+new Date-U,"0ms TO"),g(e)},j.gap),y(v,e),console.STAT&&A===e.SI&&console.STAT(E,+new Date-e.SH,"say ack")}};s.say.c=s.say.d=0,s.raw=function(n,e){if(!n)return"";var c=n._||{},S,b;if(b=c.raw)return b;if(typeof n=="string")return n;var v=n["##"],A=n["@"];if(v&&A){if(!c.via&&a(A+v))return!1;if(b=(T.s[A]||"").it){if(v===b["##"])return!1;b["##"]||(b["##"]=v)}}if(!n.dam&&!n["@"]){var N=0,B=[];b=j.peers;for(var E in b){var W=b[E];if(B.push(W.url||W.pid||W.id),++N>6)break}N>1&&(n["><"]=B.join())}if(n.put&&(b=n.ok)&&(n.ok={"@":(b["@"]||1)-1,"/":b["/"]==n._.near?s.near:b["/"]}),S=c.$put){b={},Object.keys(n).forEach(function(C){b[C]=n[C]}),b.put=":])([:",k(b,function(C,U){if(!C){var V=+new Date;b=U.indexOf('"put":":])([:"'),P(l,U=U.slice(0,b+6)+S+U.slice(b+14)),console.STAT&&console.STAT(V,+new Date-V,"say slice")}});return}k(n,P);function P(C,U){C||(c.raw=U,s.say(n,e))}}}();function g(o){var _=o.batch,M=typeof _=="string",J;if(M&&(_+="]"),o.batch=o.tail=null,!!_&&!(M?3>_.length:!_.length)){if(!M)try{_=_.length===1?_[0]:JSON.stringify(_)}catch(t){return j.log("DAM JSON stringify error",t)}_&&y(_,o)}}function y(o,_){try{var M=_.wire;_.say?_.say(o):M.send&&M.send(o),s.say.d+=o.length||0,++s.say.c}catch{(_.queue=_.queue||[]).push(o)}}s.near=0,s.hi=function(o){var _=o.wire,M;if(!_){s.wire(o.length&&{url:o,id:o}||o);return}o.id?j.peers[o.url||o.id]=o:(M=o.id=o.id||o.url||String.random(9),s.say({dam:"?",pid:i.opt.pid},j.peers[M]=o),delete T.s[o.last]),o.met||(s.near++,o.met=+new Date,i.on("hi",o)),M=o.queue,o.queue=[],setTimeout.each(M||[],function(J){y(J,o)},0,9)},s.bye=function(o){o.met&&--s.near,delete o.met,i.on("bye",o);var _=+new Date;_=_-(o.met||_),s.bye.time=((s.bye.time||_)+_)/2},s.hear["!"]=function(o,_){j.log("Error:",o.err)},s.hear["?"]=function(o,_){o.pid&&(_.pid||(_.pid=o.pid),o["@"])||(s.say({dam:"?",pid:j.pid,"@":o["#"]},_),delete T.s[_.last])},s.hear.mob=function(o,_){if(o.peers){var M=Object.keys(o.peers),J=M[Math.random()*M.length>>0];J&&(s.bye(_),s.hi(J))}},i.on("create",function(o){o.opt.pid=o.opt.pid||String.random(9),this.to.next(o),o.on("out",s.say)}),i.on("bye",function(o,_){o=j.peers[o.id||o]||o,this.to.next(o),o.bye?o.bye():(_=o.wire)&&_.close&&_.close(),delete j.peers[o.id],o.wire=null});var I={};return i.on("bye",function(o,_){this.to.next(o),(_=console.STAT)&&(_.peers=s.near),(_=o.url)&&(I[_]=!0,setTimeout(function(){delete I[_]},j.lack||9e3))}),i.on("hi",function(o,_){if(this.to.next(o),(_=console.STAT)&&(_.peers=s.near),!j.super){var M=Object.keys(i.next||"");M.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(M,function(J){var t=i.next[J];if(j.super||(t.ask||"")[""]){s.say({get:{"#":J}},o);return}setTimeout.each(Object.keys(t.ask||""),function(n){n&&s.say({"##":String.hash((i.graph[J]||"")[n]),get:{"#":J,".":n}},o)})})}}),s}var m={},D=!0,l;try{q.exports=x}catch{}})($,"./mesh"),$(function(q){var u=$("./index");u.Mesh=$("./mesh"),u.on("opt",function(x){if(this.to.next(x),x.once)return;var m=x.opt;if(m.WebSocket===!1)return;var D=u.window||{},l=m.WebSocket||D.WebSocket||D.webkitWebSocket||D.mozWebSocket;if(!l)return;m.WebSocket=l;var i=m.mesh=m.mesh||u.Mesh(x),s=i.wire||m.wire;i.wire=m.wire=j;function j(w){try{if(!w||!w.url)return f&&f(w);var r=w.url.replace(/^http/,"ws"),f=w.wire=new m.WebSocket(r);return f.onclose=function(){T(w),m.mesh.bye(w)},f.onerror=function(p){T(w)},f.onopen=function(){m.mesh.hi(w)},f.onmessage=function(p){p&&m.mesh.hear(p.data||p,w)},f}catch{m.mesh.bye(w)}}setTimeout(function(){!m.super&&x.on("out",{dam:"hi"})},1);var d=2*999;function T(w){clearTimeout(w.defer),m.peers[w.url]&&(a&&w.retry<=0||(w.retry=(w.retry||m.retry+1||60)-(-w.tried+(w.tried=+new Date)<d*4?1:0),w.defer=setTimeout(function r(){if(a&&a.hidden)return setTimeout(r,d);j(w)},d)))}var a=""+k!=typeof document&&document});var O=function(){},k})($,"./websocket"),$(function(q){if(!(typeof Gun>"u")){var u=function(){},O,k;try{O=(Gun.window||u).localStorage}catch{}O||(Gun.log("Warning: No localStorage exists to persist data to!"),O={setItem:function(D,l){this[D]=l},removeItem:function(D){delete this[D]},getItem:function(D){return this[D]}});var x=JSON.parseAsync||function(D,l,i){var s;try{l(s,JSON.parse(D,i))}catch(j){l(j)}},m=JSON.stringifyAsync||function(D,l,i,s){var j;try{l(j,JSON.stringify(D,i,s))}catch(d){l(d)}};Gun.on("create",function D(l){this.to.next(l);var i=l.opt,s=l.graph,j=[],d,T,a,w;if(i.localStorage===!1)return;i.prefix=i.file||"gun/";try{d=D[i.prefix]=D[i.prefix]||JSON.parse(a=O.getItem(i.prefix))||{}}catch{d=D[i.prefix]={}}a=(a||"").length,l.on("get",function(f){this.to.next(f);var p=f.get,h,g,y,I;!p||!(h=p["#"])||(g=d[h]||I,g&&(y=p["."])&&!Object.plain(y)&&(g=Gun.state.ify({},y,Gun.state.is(g,y),g[y],h)),Gun.on.get.ack(f,g))}),l.on("put",function(f){this.to.next(f);var p=f.put,h=p["#"],g=p["."],y=f["#"],I=f.ok||"",o;if(d[h]=Gun.state.ify(d[h],g,p[">"],p[":"],h),w&&a>4999880){l.on("in",{"@":y,err:"localStorage max!"});return}!f["@"]&&(!f._.via||Math.random()<I["@"]/I["/"])&&j.push(y),!T&&(T=setTimeout(r,9+a/333))});function r(){if(!j.length&&((setTimeout.turn||"").s||"").length){setTimeout(r,99);return}var f,p=j;clearTimeout(T),T=!1,j=[],m(d,function(h,g){try{!h&&O.setItem(i.prefix,g)}catch(y){h=w=y||"localStorage failure"}h&&(Gun.log(h+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),l.on("localStorage:error",{err:h,get:i.prefix,put:d})),a=g.length,setTimeout.each(p,function(y){l.on("in",{"@":y,err:h,ok:0})},0,99)})}})}})($,"./localStorage")})();(function(){var J;if(""+J!=typeof Gun){var $=function(t){console.warn("Warning! Deprecated internal utility will break in next version:",t)},G=Gun;G.fn=G.fn||{is:function(t){return $("fn"),!!t&&typeof t=="function"}},G.bi=G.bi||{is:function(t){return $("bi"),t instanceof Boolean||typeof t=="boolean"}},G.num=G.num||{is:function(t){return $("num"),!q(t)&&(t-parseFloat(t)+1>=0||t===1/0||t===-1/0)}},G.text=G.text||{is:function(t){return $("text"),typeof t=="string"}},G.text.ify=G.text.ify||function(t){return $("text.ify"),G.text.is(t)?t:typeof JSON<"u"?JSON.stringify(t):t&&t.toString?t.toString():t},G.text.random=G.text.random||function(t,n){$("text.random");var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";t>0;)e+=n.charAt(Math.floor(Math.random()*n.length)),t--;return e},G.text.match=G.text.match||function(t,n){var e,c;return $("text.match"),typeof t!="string"?!1:(typeof n=="string"&&(n={"=":n}),n=n||{},e=n["="]||n["*"]||n[">"]||n["<"],t===e?!0:c!==n["="]?!1:(e=n["*"]||n[">"]||n["<"],t.slice(0,(e||"").length)===e?!0:c!==n["*"]?!1:c!==n[">"]&&c!==n["<"]?t>=n[">"]&&t<=n["<"]:c!==n[">"]&&t>=n[">"]||c!==n["<"]&&t<=n["<"]))},G.text.hash=G.text.hash||function(t,n){if($("text.hash"),typeof t=="string"){if(n=n||0,!t.length)return n;for(var e=0,c=t.length,S;e<c;++e)S=t.charCodeAt(e),n=(n<<5)-n+S,n|=0;return n}},G.list=G.list||{is:function(t){return $("list"),t instanceof Array}},G.list.slit=G.list.slit||Array.prototype.slice,G.list.sort=G.list.sort||function(t){return $("list.sort"),function(n,e){return!n||!e?0:(n=n[t],e=e[t],n<e?-1:n>e?1:0)}},G.list.map=G.list.map||function(t,n,e){return $("list.map"),_(t,n,e)},G.list.index=1,G.obj=G.boj||{is:function(t){return $("obj"),t?t instanceof Object&&t.constructor===Object||Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},G.obj.put=G.obj.put||function(t,n,e){return $("obj.put"),(t||{})[n]=e,t},G.obj.has=G.obj.has||function(t,n){return $("obj.has"),t&&Object.prototype.hasOwnProperty.call(t,n)},G.obj.del=G.obj.del||function(t,n){if($("obj.del"),!!t)return t[n]=null,delete t[n],t},G.obj.as=G.obj.as||function(t,n,e,c){return $("obj.as"),t[n]=t[n]||(c===e?{}:e)},G.obj.ify=G.obj.ify||function(t){if($("obj.ify"),h(t))return t;try{t=JSON.parse(t)}catch{t={}}return t},function(){var t;function n(e,c){y(this,c)&&t!==this[c]||(this[c]=e)}G.obj.to=G.obj.to||function(e,c){return $("obj.to"),c=c||{},_(e,n,c),c}}(),G.obj.copy=G.obj.copy||function(t){return $("obj.copy"),t&&JSON.parse(JSON.stringify(t))},function(){function t(n,e){var c=this.n,S;if(!(c&&(e===c||h(c)&&y(c,e)))&&S!==e)return!0}G.obj.empty=G.obj.empty||function(n,e){return $("obj.empty"),n?!_(n,t,{n:e}):!0}}(),function(){function t(S,b){if(arguments.length===2){t.r=t.r||{},t.r[S]=b;return}t.r=t.r||[],t.r.push(S)}var n=Object.keys,e,c;Object.keys=Object.keys||function(S){return e(S,function(b,v,A){A(v)})},G.obj.map=e=G.obj.map||function(S,b,v){$("obj.map");var A,N=0,B,E,W,P,C=typeof b=="function";if(t.r=A,n&&h(S)&&(W=n(S),P=!0),v=v||{},q(S)||W)for(B=(W||S).length;N<B;N++){var U=N+G.list.index;if(C){if(E=P?b.call(v,S[W[N]],W[N],t):b.call(v,S[N],U,t),E!==A)return E}else if(b===S[P?W[N]:N])return W?W[N]:U}else for(N in S)if(C){if(y(S,N)&&(E=v?b.call(v,S[N],N,t):b(S[N],N,t),E!==A))return E}else if(b===S[N])return N;return C?t.r:G.list.index?0:-1}}(),G.time=G.time||{},G.time.is=G.time.is||function(t){return $("time"),t?t instanceof Date:+new Date().getTime()};var f=G.fn.is,q=G.list.is,p=G.obj,h=p.is,y=p.has,_=p.map,u={};u.is=function(t){return $("val.is"),t===J?!1:t===null?!0:t===1/0?!1:x(t)||k(t)||T(t)?!0:u.link.is(t)||!1},u.link=u.rel={_:"#"},function(){u.link.is=function(n){if($("val.link.is"),n&&n[O]&&!n._&&h(n)){var e={};if(_(n,t,e),e.id)return e.id}return!1};function t(n,e){var c=this;if(c.id)return c.id=!1;if(e==O&&x(n))c.id=n;else return c.id=!1}}(),u.link.ify=function(t){return $("val.link.ify"),o({},O,t)},G.obj.has._=".";var O=u.link._,J,k=G.bi.is,T=G.num.is,x=G.text.is,p=G.obj,h=p.is,o=p.put,_=p.map;G.val=G.val||u;var m={_:"_"};m.soul=function(t,n){return $("node.soul"),t&&t._&&t._[n||i]},m.soul.ify=function(t,n){return $("node.soul.ify"),n=typeof n=="string"?{soul:n}:n||{},t=t||{},t._=t._||{},t._[i]=n.soul||t._[i]||l(),t},m.soul._=u.link._,function(){m.is=function(n,e,c){$("node.is");var S;return h(n)&&(S=m.soul(n))?!_(n,t,{as:c,cb:e,s:S,n}):!1};function t(n,e){if(e!==m._){if(!u.is(n))return!0;this.cb&&this.cb.call(this.as,n,e,this.n,this.s)}}}(),function(){m.ify=function(n,e,c){return $("node.ify"),e?typeof e=="string"?e={soul:e}:typeof e=="function"&&(e={map:e}):e={},e.map&&(e.node=e.map.call(c,n,J,e.node||{})),(e.node=m.soul.ify(e.node||{},e))&&_(n,t,{o:e,as:c}),e.node};function t(n,e){var c=this.o,S,b;if(c.map){S=c.map.call(this.as,n,""+e,c.node),b===S?g(c.node,e):c.node&&(c.node[e]=S);return}u.is(n)&&(c.node[e]=n)}}();var p=G.obj,h=p.is,g=p.del,_=p.map,D=G.text,l=D.random,i=m.soul._,J;G.node=G.node||m;var s=G.state;s.lex=function(){return $("state.lex"),s().toString(36).replace(".","")},s.to=function(t,n,e){$("state.to");var c=(t||{})[n];return h(c)&&(c=M(c)),s.ify(e,n,s.is(t,n),c,m.soul(t))},function(){s.map=function(n,e,c){$("state.map");var S,b=h(b=n||e)?b:null;return n=f(n=n||e)?n:null,b&&!n?(e=T(e)?e:s(),b[w]=b[w]||{},_(b,t,{o:b,s:e}),b):(c=c||h(e)?e:S,e=T(e)?e:s(),function(v,A,N,B){if(!n)return t.call({o:N,s:e},v,A),v;n.call(c||this||{},v,A,N,B),!(y(N,A)&&S===N[A])&&t.call({o:N,s:e},v,A)})};function t(n,e){w!==e&&s.ify(this.o,e,this.s)}}();var p=G.obj,j=p.as,y=p.has,h=p.is,_=p.map,M=p.copy,d=G.num,T=d.is,a=G.fn,f=a.is,w=m._,J,r={};(function(){r.is=function(e,c,S,b){return $("graph.is"),!e||!h(e)||I(e)?!1:!_(e,t,{cb:c,fn:S,as:b})};function t(e,c){if(!e||c!==m.soul(e)||!m.is(e,this.fn,this.as))return!0;this.cb&&(n.n=e,n.as=this.as,this.cb.call(n.as,e,c,n))}function n(e){e&&m.is(n.n,e,n.as)}})(),function(){r.ify=function(b,v,A){$("graph.ify");var N={path:[],obj:b};return v?typeof v=="string"?v={soul:v}:typeof v=="function"&&(v.map=v):v={},typeof A=="string"&&(v.soul=v.soul||A,A=J),v.soul&&(N.link=u.link.ify(v.soul)),v.shell=(A||{}).shell,v.graph=v.graph||{},v.seen=v.seen||[],v.as=v.as||A,t(v,N),v.root=N.node,v.graph};function t(b,v){var A;return(A=S(b,v))?A:(v.env=b,v.soul=e,m.ify(v.obj,n,v)&&(v.link=v.link||u.link.ify(m.soul(v.node)),v.obj!==b.shell&&(b.graph[u.link.is(v.link)]=v.node)),v)}function n(b,v,A){var N=this,B=N.env,E,W;if(m._===v&&y(b,u.link._))return A._;if(E=c(b,v,A,N,B)){if(v||(N.node=N.node||A||{},y(b,m._)&&m.soul(b)&&(N.node._=M(b._)),N.node=m.soul.ify(N.node,u.link.is(N.link)),N.link=N.link||u.link.ify(m.soul(N.node))),(W=B.map)&&(W.call(B.as||{},b,v,A,N),y(A,v))){if(b=A[v],J===b){g(A,v);return}if(!(E=c(b,v,A,N,B)))return}if(!v)return N.node;if(E===!0)return b;if(W=t(B,{obj:b,path:N.path.concat(v)}),!!W.node)return W.link}}function e(b){var v=this,A=u.link.is(v.link),N=v.env.graph;v.link=v.link||u.link.ify(b),v.link[u.link._]=b,v.node&&v.node[m._]&&(v.node[m._][u.link._]=b),y(N,A)&&(N[b]=N[A],g(N,A))}function c(b,v,A,N,B){var E;if(u.is(b))return!0;if(h(b))return 1;if(E=B.invalid)return b=E.call(B.as||{},b,v,A),c(b,v,A,N,B);B.err="Invalid value at '"+N.path.concat(v).join(".")+"'!",G.list.is(b)&&(B.err+=" Use `.set(item)` instead of an Array.")}function S(b,v){for(var A=b.seen,N=A.length,B;N--;)if(B=A[N],v.obj===B.obj)return B;A.push(v)}}(),r.node=function(t){$("graph.node");var n=m.soul(t);if(n)return o({},n,t)},function(){r.to=function(n,e,c){if($("graph.to"),!!n){var S={};return c=c||{seen:{}},_(n[e],t,{obj:S,graph:n,opt:c}),S}};function t(n,e){var c,S;if(m._===e){if(I(n,u.link._))return;this.obj[e]=M(n);return}if(!(c=u.link.is(n))){this.obj[e]=n;return}if(S=this.opt.seen[c]){this.obj[e]=S;return}this.obj[e]=this.opt.seen[c]=r.to(this.graph,c,this.opt)}}();var f=G.fn.is,p=G.obj,h=p.is,g=p.del,y=p.has,I=p.empty,o=p.put,_=p.map,M=p.copy,J;G.graph=G.graph||r}})()});var tt=X((ft,Z)=>{Z.exports=Y()});var nt=tt();async function et(){var q=nt(["https://gun-manhattan.herokuapp.com/gun"]).get("rooms").get("global");let u=document.querySelector("#sign"),O=document.querySelector("#alias"),k=document.querySelector("#sign-in"),x=document.querySelector("#chat"),m=document.querySelector("#send"),D=document.querySelector("#text-input"),l=document.querySelector("#messages");var i;let s=[],j=[];k.onclick=d=>{i=O.value,it(i)&&(u.style.display="none",x.style.display="block")},m.onclick=()=>{let d=s.pop()??{};d.who=i,d.what=D.value,d.when=JSON.stringify(new Date),q.get("messages").set(d),D.value=null},q.get("messages").map().once(d=>{var T=j.pop()??document.createElement("li");T.id=d.when,T.textContent=`${d.who} > ${d.what}`,l.appendChild(T)})}et();function it($){return $.toString().trim()!=""}})();
